services:
  hopfield-service:
    build:
      context: ./hopfield
      dockerfile: Dockerfile
    container_name: hopfield-assignment-solver
    environment:
      - PYTHONPATH=/app/src
      - FLASK_ENV=production
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/health"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 20s
    networks:
      - ci-network
    restart: "no"

  api-gateway:
    build:
      context: ./api
      dockerfile: Dockerfile
    container_name: hopfield-api-gateway
    environment:
      - PORT=8080
      - GIN_MODE=release
      - HOPFIELD_SERVICE_URL=http://hopfield-service:5000
    depends_on:
      hopfield-service:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:8080/health"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 20s
    networks:
      - ci-network
    restart: "no"

networks:
  ci-network:
    driver: bridge
